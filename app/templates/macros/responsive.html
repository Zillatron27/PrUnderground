{#
    Responsive display macros for PrUnderground
    These macros provide both full and condensed versions of common display elements.
    CSS controls which version is visible based on screen size.
#}

{# CX station abbreviations #}
{% set CX_ABBREV = {
    'Antares Station': 'ANT',
    'Moria Station': 'MOR',
    'Benten Station': 'BEN',
    'Hortus Station': 'HRT',
    'Arclight Station': 'ARC'
} %}

{#
    Material ticker display
    Always bold, monospace, cyan - same at all sizes
#}
{% macro material_ticker(ticker) -%}
<span class="ticker">{{ ticker }}</span>
{%- endmacro %}

{#
    Seller display with optional corp code
    Desktop: [CORP] Username
    Medium/Narrow: Username only
#}
{% macro seller_display(user) -%}
<a href="/u/{{ user.fio_username }}">
    {%- if user.company_code %}<span class="hide-medium">[{{ user.company_code }}] </span>{% endif -%}
    {{ user.fio_username }}
</a>
{%- endmacro %}

{#
    CX location display
    Desktop: Full name (Moria Station)
    Medium/Narrow: Abbreviation (MOR)
#}
{% macro cx_location(location) -%}
{%- if location -%}
    <span class="hide-medium">{{ location }}</span>
    <span class="show-medium">{{ CX_ABBREV.get(location, location) }}</span>
{%- else -%}
    —
{%- endif -%}
{%- endmacro %}

{#
    Price display
    Desktop: Full formatted price (CX.NC1-10%, 1,500/u)
    Medium/Narrow: Condensed (CX-10%, 1.5k/u)
#}
{% macro price_display(listing) -%}
<span class="hide-medium">{{ format_price(listing) }}</span>
<span class="show-medium">
    {%- if listing.price_type.value == 'absolute' and listing.price_value is not none -%}
        {{ condense_number(listing.price_value) }}/u
    {%- elif listing.price_type.value == 'cx_relative' and listing.price_value is not none -%}
        CX{{ '{:+.0f}'.format(listing.price_value) }}{% if not listing.price_cx_is_absolute %}%{% endif %}
    {%- else -%}
        —
    {%- endif -%}
</span>
{%- endmacro %}

{#
    Quantity display with stock status
    Desktop: Number + text badge (OUT OF STOCK, LOW STOCK)
    Medium/Narrow: Number + color dot indicator
#}
{% macro quantity_display(listing) -%}
{%- set qty = listing.available_quantity if listing.available_quantity is not none else listing.quantity -%}
{%- set status = get_stock_status(listing) -%}
<span class="qty-value">
    {%- if qty is not none -%}
        {{ '{:,}'.format(qty) }}
    {%- else -%}
        —
    {%- endif -%}
</span>
{%- if status == 'out' -%}
    <span class="badge badge-out-of-stock hide-medium">OUT OF STOCK</span>
    <span class="stock-dot stock-out show-medium" title="Out of stock"></span>
{%- elif status == 'low' -%}
    <span class="badge badge-low-stock hide-medium">LOW STOCK</span>
    <span class="stock-dot stock-low show-medium" title="Low stock"></span>
{%- endif -%}
{%- endmacro %}

{#
    Bundle price display
    Desktop: Full formatted price
    Medium/Narrow: Condensed
#}
{% macro bundle_price_display(bundle) -%}
{%- if bundle.price -%}
    <span class="hide-medium">{{ '{:,.0f}'.format(bundle.price) }} {{ bundle.currency or '' }}</span>
    <span class="show-medium">{{ condense_number(bundle.price) }}{{ ' ' + bundle.currency if bundle.currency else '' }}</span>
{%- else -%}
    Contact me
{%- endif -%}
{%- endmacro %}

{#
    Bundle quantity display
    Desktop: Full number with comma formatting
    Medium/Narrow: Condensed
#}
{% macro bundle_quantity_display(bundle) -%}
{%- if bundle.quantity -%}
    <span class="hide-medium">{{ '{:,}'.format(bundle.quantity) }}</span>
    <span class="show-medium">{{ condense_number(bundle.quantity) }}</span>
{%- else -%}
    —
{%- endif -%}
{%- endmacro %}

{#
    Date display
    Desktop: DD-MM-YYYY
    Medium/Narrow: DD Mon (e.g., 26 Jan)
#}
{% macro date_display(dt) -%}
<span class="hide-medium">{{ dt.strftime('%d-%m-%Y') }}</span>
<span class="show-medium">{{ dt.strftime('%d %b') }}</span>
{%- endmacro %}

{#
    Dashboard quantity display (for live inventory)
    Desktop: Full number with comma formatting
    Medium/Narrow: Condensed (184.6k)
#}
{% macro dashboard_qty(value) -%}
{%- if value is not none -%}
<span class="hide-medium">{{ '{:,}'.format(value) }}</span>
<span class="show-medium">{{ condense_number(value) }}</span>
{%- else -%}
—
{%- endif -%}
{%- endmacro %}
